<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Page</title>
</head>
<body>
    <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./editpage.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish">
    <link href='https://fonts.googleapis.com/css?family=Roboto Mono' rel='stylesheet'>

    <title>Create a Post</title>

</head>
<body>
    <div class="nav">

        <div class="nav-title">
            <p><a href="./adminpage.html">Dasboard</a></p>
        </div>

        <div class="profile">

           

            <div class="divider"><hr></div>

            <div class="name">
                <h5>Kevin kalimba</h5>
            </div>

            <div class="p-image">
                <img src="./icon.jpeg" alt="">
            </div>
        </div>
    </div>

    <section class="create-post">
        <form class="create-blog-post" name="create" method="POST" id="form">
            <h3 class="post-title">Edit Title of Post</h3>
            <input type="text" name="title" placeholder="Title" id="title"/>
            
           
            <h3 class="post-title">Edit Post image</h3>
            <input type="file" name="image" class="fileBtn" id="img"/>
        <div class="imgPreview" >
            <img class="preview" alt="" id="imagePreview" />
        </div>
        <h3 class="post-title">Edit Post content</h3>
        <textarea name="content" placeholder="Edit the content" id="content"></textarea>

        <h3 class="post-title">Edit Post body</h3>
    <textarea name="body" placeholder="Edit the Body" id="body"></textarea>


        <button class="submit create-btn" type="submit ">UPDATE</button>
        </form>
    </section>

    <script>
      const blogId = location.search.substring(1)
      console.log(blogId);


        function getDataForm() {
          if (localStorage.getItem("id")) {
        
            document.getElementById("title").value = localStorage.getItem("title")
            document.getElementById("content").value = localStorage.getItem("content")
            document.getElementById("body").value = localStorage.getItem("body")
            document.getElementById("imagePreview").style.display = "none";
    
          } else {
            document.getElementById("img").required = '';
          
          }
        }
        getDataForm();
        let token = localStorage.getItem("token");
        async function addDataToCollection(title, content, body, imageUrl) {
    
          var myHeaders = new Headers();
          myHeaders.append("Authorization", token);
          myHeaders.append("Content-Type", "application/json");
    
          var raw = JSON.stringify({
            "title": title,
            "content": content,
            "body": body,
            "imageUrl": image
          });
    
          var requestOptions = {
            method: 'POST',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
          };
    
          fetch("https://kalimbacapstone.herokuapp.com/blogs", requestOptions)
            .then(response => response.json())
            .then(result => {
              console.log(result)
              alert("Article created well done")
              location.href = '/dashboard/blog.html'
    
            })
            .catch(error => console.log('error', error));
        }
    
      
 let requestOption = {
     method: 'GET',
     redirect:'follow'
 };
 fetch(`https://kalimbacapstone.herokuapp.com/blogs/${blogId}`, requestOption)
 .then(response => response.json())
 .then(result =>{
     console.log(result)
    document.getElementById("title").value = result.title
    document.getElementById("content").value = result.content
    document.getElementById("body").value = result.body
    document.getElementById("imagePreview").setAttribute('url', result.image)

 })


    
        function update(id, title, content, body ) {
    
          var myHeaders = new Headers();
          myHeaders.append("Authorization", token);
          myHeaders.append("Content-Type", "application/json");
    
          var raw = JSON.stringify({
            "title": title,
            "content": content,
            "body": body,
       
          });
    
          var requestOptions = {
            method: 'PATCH',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
          };
    
          fetch(`https://kalimbacapstone.herokuapp.com/blogs/${id}`, requestOptions)
            .then(response => response.text())
            .then(result => {
              console.log(result)
              alert("Article updated well done")
              location.href = 'adminpage.html'
            })
            .catch(error => console.log('error', error));
          // localStorage.clear();
        }
    
      </script>
</body>
</html>
</body>
</html>

