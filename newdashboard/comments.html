<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/8fb78c4ea1.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="adminpage.css">
    <script src="./authentication.js"></script>
    <link href="/kkkkk.jpg" rel="icon">

    <link href='https://fonts.googleapis.com/css?family=Roboto Mono' rel='stylesheet'>
    <script src="../public/assets/js/logout.js"></script>
    <title>comments</title>
    
</head>
<body>
    <div class="container">
        <div class="navigation">
            <ul>
                <li>
                   <a href="#">
                    <span class="icon"><i class="fas fa-user"></i></span>
                    <span class="title"><h2>Admin</h2></span>
                   </a>
                </li>
                <li>
                   <a href="./addarticles.html">
                    <span class="icon"><i class="far fa-newspaper"></i></span>
                    <span class="title">Add Articles</span>
                   </a>
                </li>
             
                <li>
                    <a href="./Articles.html">
                     <span class="icon"><i class="far fa-newspaper"></i></span>
                     <span class="title">Articles</span>
 
                    </a>
                    
                 </li>
                 <li>
                    <a href="./sitemessages.html">
                     <span class="icon"><i class="fas fa-comment"></i></span>
                     <span class="title"> Messages</span>
                    </a>
                </li>
                <li>
                    <a href="./comments.html">
                     <span class="icon"><i class="fas fa-comment"></i></span>
                     <span class="title"> Comments</span>
                    </a>
                </li>
                <li class="logout">
                   <a href="#">
                    <span class="icon"><i class="fas fa-sign-out-alt"></i> </span>
                    <span class="title" onclick="logout()">Logout</span>
                   </a>
                </li>
            </ul>

        </div>
    
    <div class="main">
        <div class="topbar">
            <div class="toggle" onclick="toggleMenu();"></div>
            <div class="search">
                <label>
                    <input type="text" placeholder="search here">
                    <i class="fas fa-search"></i>
                </label>
                </div>
                <div class="user">
                    <img class="user" src="/newdashboard/about.jpg">
    
                
            </div>
            
           
        </div>
        <main>
            <h1>List of all Contact</h1>
            <div class=" bg-danger">

                <table class="table   table-light table-hover" style="background-color: white;">
                    <thead class="thead-dark">
                        <tr>
                                <th>NO</th>
                                <th>Name</th>
                            <th>Email</th>
                            <th>comment</th>
                          
                        </tr>
                    
                    </thead>
                            <tbody id="comments" class="tbody-light">
                   
                    </tbody>
                </table>
            </div>
        </main>
        <div class="main-content">
            <div class="body">
                <div class="messages">
                     
                </div>
            </div>
              
        </div>
        <div id="cards"></div>
        </div>
        
    </div>
    </div>
    <script>
        function toggleMenu(){
         let toggle = document.querySelector('.toggle');
         let navigation = document.querySelector('.navigation');
         let main = document.querySelector('.main');
         main.classList.toggle('active')
         toggle.classList.toggle('active');
         navigation.classList.toggle('active');
}
    </script>
        <!-- <script src="./sitemessages.js"></script> -->
        
<!-- <script>
      const blogId = location.search.substring(1)

let norows = 0
function getdataOnIndex()  {
    let posts_div = document.getElementById("comments");
    let dataToDisplay= "";
    let requestOptions = {
        method: 'GET',
        redirect: 'follow'
      };
      fetch(`https://kalimbacapstone.herokuapp.com/blogs/${blogId}/comments/${blogId}`, requestOptions)
               .then(response => response.json())

               .then(result => {
                  console.log(result.result);
                       result.result.forEach(element=>{
                           dataToDisplay += `
                 <tr>
                 <td>
                               ${norows += 1}
                           </td>
                           <td>
                               ${element.names}
                           </td>
                           <td>
                              ${element.email}
                           </td>
                           <td>
                               ${element.comment}
                           </td>
                        
                           <td>
                               <div class="flex">
                            
                               <a href="#">
                                   <button id='${element._id}' onclick='delete_message(
         this.id
       )' class="delete-button">Delete</button>
  
                                  
                           </td>
                       </tr>
                       `;
                     })
                     posts_div.innerHTML = dataToDisplay;
                    console.log(posts_div)
               })
               .catch(error => console.log('error', error));
     } window.onload=getdataOnIndex();
</script> -->
<script>
      const blogId = location.search.substring(1)
      console.log(blogId);

 let norows = 0
function getdataOnIndex()  {
    let posts_div = document.getElementById("comments");
    let dataToDisplay="";
    let requestOptions = {
        method: 'GET',
        redirect: 'follow'
      };
      fetch(`https://kalimbacapstone.herokuapp.com/blogs/${blogId}/Comments`, requestOptions)
               .then(response => response.json())

               .then(result => {
                  console.log(result.result);
                       result.result.forEach(element=>{
                           dataToDisplay += `
                 <tr>
                 <td>
                               ${norows += 1}
                           </td>
                           <td>
                               ${element.names}
                           </td>
                           <td>
                              ${element.email}
                           </td>
                           <td>
                               ${element.comment}
                           </td>
                         
                           <td>
                               <div class="flex">
                               <a href="#">
                                   <button id='${element._id}' onclick='delete_message(
         this.id
       )' class="delete-button">Delete</button>
  
                                  
                           </td>
                       </tr>
                       `;
                     })
                     posts_div.innerHTML = dataToDisplay;
                    console.log(posts_div)
               })
               .catch(error => console.log('error', error));
            }

            function delete_message(id) {
                let token = localStorage.getItem("token");
                console.log(id)
                var myHeaders = new Headers();
                myHeaders.append("Authorization", token);
          
                var requestOptions = {
                  method: 'DELETE',
                  headers: myHeaders,
                  redirect: 'follow'
                };
          
                fetch(`https://kalimbacapstone.herokuapp.com/blogs/${blogId}/Comments/${id}`, requestOptions)
                  .then(response => response.text())
                  .then(result => {
                    console.log(result)
                    alert("comment deleted well done")
                    getdataOnIndex()
        
        
                  })
        
                
              
                .catch(error => console.log('error', error));
              }
            window.onload=getdataOnIndex();
</script>
</body>
</html>